(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{551:function(s,t){s.exports="data:image/png;base64,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"},552:function(s,t,a){s.exports=a.p+"assets/img/035.afa574bf.png"},553:function(s,t,a){s.exports=a.p+"assets/img/036.afa574bf.png"},554:function(s,t,a){s.exports=a.p+"assets/img/037.f5f1ada1.png"},555:function(s,t,a){s.exports=a.p+"assets/img/038.83f64490.png"},556:function(s,t,a){s.exports=a.p+"assets/img/039.a474afc6.png"},557:function(s,t,a){s.exports=a.p+"assets/img/040.c519992f.png"},558:function(s,t,a){s.exports=a.p+"assets/img/041.cfe9992c.png"},590:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"入门程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#入门程序"}},[s._v("#")]),s._v(" 入门程序")]),s._v(" "),t("h3",{attrs:{id:"准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备")]),s._v(" "),t("p",[t("code",[s._v("maven")])]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-security"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("code",[s._v("controller")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" userController "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("helloSpringSecurity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello SpringSecurity"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("code",[s._v("yml")])]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("security")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" zwh\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结果"}},[s._v("#")]),s._v(" 结果")]),s._v(" "),t("p",[t("img",{attrs:{src:a(551),alt:"image-20231114155652128"}})]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("ul",[t("li",[s._v("引入"),t("strong",[s._v("SpringSecurity")]),s._v("后，每次访问前需要认证，输入用户和密码，认证后当前可以访问任意资源")]),s._v(" "),t("li",[s._v("此案例中用户和密码在yml中配置【这种方式只能配置一个用户】，不配置会在控制台生成密码，用户名默认是user")])])]),t("h2",{attrs:{id:"基本原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本原理"}},[s._v("#")]),s._v(" 基本原理")]),s._v(" "),t("p",[s._v("SpringSecurity本质是"),t("strong",[s._v("过滤器链")]),s._v("【Filter chains】，由多个过滤器组成，放行后进入下一个过滤器。")]),s._v(" "),t("h3",{attrs:{id:"securityconfigureradapter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#securityconfigureradapter"}},[s._v("#")]),s._v(" "),t("strong",[s._v("SecurityConfigurerAdapter：")])]),s._v(" "),t("p",[s._v("​\t过滤器链中的每个过滤器都由"),t("code",[s._v("SecurityConfigurerAdapter")]),s._v("实现。这些配置适配器负责定义过滤器的行为，包括身份验证管理、访问控制规则等。")]),s._v(" "),t("h3",{attrs:{id:"filter-chain的执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filter-chain的执行"}},[s._v("#")]),s._v(" "),t("strong",[s._v("Filter Chain的执行：")])]),s._v(" "),t("p",[s._v("​\t当客户端发送请求时，该请求将被传递给过滤器链。过滤器链按照配置的顺序逐个执行，每个过滤器都有机会对请求进行处理。")]),s._v(" "),t("p",[t("strong",[s._v("SecurityContextHolder：")])]),s._v(" "),t("p",[s._v("​\t 过滤器链中的过滤器可以访问"),t("code",[s._v("SecurityContextHolder")]),s._v("，它存储了与当前线程关联的安全上下文。安全上下文包含了用户的身份信息和相应的权限。")]),s._v(" "),t("h2",{attrs:{id:"认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#认证"}},[s._v("#")]),s._v(" 认证")]),s._v(" "),t("h3",{attrs:{id:"认证流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#认证流程"}},[s._v("#")]),s._v(" 认证流程")]),s._v(" "),t("p",[t("img",{attrs:{src:a(552),alt:"image-20231125180631282"}})]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("ul",[t("li",[t("p",[s._v("输入用户名和密码，提交")])]),s._v(" "),t("li",[t("p",[s._v("把提交用户名和密码封装对象(Authenticatio)")])]),s._v(" "),t("li",[t("p",[s._v("调用方法实现认证->调用方法，根据用户名查询用户信息")])]),s._v(" "),t("li",[t("p",[s._v("查询用户信息返回用户对象(UserDetails)")])]),s._v(" "),t("li",[t("p",[s._v("密码比较(Password、UserDetails、Authenticatio)")])]),s._v(" "),t("li",[t("p",[s._v("填充回对象(Authenticatio)")])]),s._v(" "),t("li",[t("p",[s._v("返回对象(Authenticatio)放到上下文对象里面(SecurityContex)")])])])]),t("h3",{attrs:{id:"认证核心组件【必看】"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#认证核心组件【必看】"}},[s._v("#")]),s._v(" 认证核心组件【必看】")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[t("code",[s._v("Authentication")])]),s._v("，它存储了认证信息，代表当前登录用户。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Principal")]),s._v("：用户信息，没有认证时一般是用户名，认证后一般是用户对象")]),s._v(" "),t("li",[t("code",[s._v("Credentials")]),s._v("：用户凭证，一般是密码")]),s._v(" "),t("li",[t("code",[s._v("Authorities")]),s._v("：用户权限")])])]),s._v(" "),t("li",[t("p",[s._v("最终存储在 "),t("strong",[t("code",[s._v("SecurityContext")])]),s._v(" ，可以通过它来获取`Authentication``")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("SecurityContext")]),s._v("就是我们的上下文对象，可以在任何时期使用。(参考servletContext)")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("SecurityContextHolder")]),s._v("管理上下文对象，可以通过它来获取上下文对象")])])]),s._v(" "),t("h3",{attrs:{id:"用户认证过程源码【必看】"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户认证过程源码【必看】"}},[s._v("#")]),s._v(" 用户认证过程源码【必看】")]),s._v(" "),t("p",[s._v("代码结合此图查看")]),s._v(" "),t("p",[t("img",{attrs:{src:a(553),alt:"image-20231125194339304"}})]),s._v(" "),t("p",[s._v("IDEA查看"),t("code",[s._v("UsernamePasswordAuthenticationFilter")]),s._v("。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("登录过滤器，用户名和密码的校验")])]),s._v(" "),t("li",[t("p",[s._v("其中方法【"),t("code",[s._v("子类可重写")]),s._v("】")])])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Authentication")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("attemptAuthentication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthenticationException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \n \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//\t1.在此方法中，我们可以从request获取请求方式、用户名和密码【可能输入为null,获取不到，try...catch或判断null】")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//\t2.可以单独获取用户名和密码[这种方式需要保证用户名是username,密码是password](默认方式)")]),s._v("\n  \t\t"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("obtainUsername")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("obtainPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  3.也可以使用流的方式，可以封装为对象,这里loginVo自定义的")]),s._v("\n  \t\t"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoginVo")]),s._v(" loginVo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readValue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInputStream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoginVo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  4.将用户信息封装到UsernamePasswordAuthenticationToken，这里可以使用多态")]),s._v("\n  \t\t "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Authentication")]),s._v(" authenticationToken "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UsernamePasswordAuthenticationToken")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  5.返回给此过滤器")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAuthenticationManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("authRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("这里我们提到了"),t("code",[s._v("UsernamePasswordAuthenticationFilter")]),s._v("、"),t("code",[s._v("Authentication")]),s._v("、"),t("code",[s._v("UsernamePasswordAuthenticationToken")])])]),t("p",[s._v("第5步说明")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nauthenticate()负责认证,此方法在AuthenticationManager中\ngetAuthenticationManager()就是得到AuthenticationManager\n*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAuthenticationManager")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("authRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nAuthenticationManager的authenticat()的有一个实现类ProviderManager\nProviderManager中又委托AuthenticationProvider的authenticat()完成认证\n*/")]),s._v("\nresult "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" provider"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("authentication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nAuthenticationProvider的authenticat()由一个(抽象)实现类\nAbstractUserDetailsAuthenticationProvider。\n该抽象类又有一个实现类 DaoAuthenticationProvider\n根据条件其中会调用UserDetailsService的唯一方法loadUserByUsername()来校验用户是否有效\n此后通过加密机校验密码\n*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUserDetailsService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadUserByUsername")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//完成认证后回填，返回的还是Authentication，即用户对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createSuccessAuthentication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("principal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" authentication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n最后在UsernamePasswordAuthenticationFilter的父类abstractAuthenticationProcessingFilter\n中还有两个重要方法认证成功和认证失败\n*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("successfulAuthentication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("参数"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("，authResult"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//成功后会将用户对象存储在Security上下文")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecurityContextHolder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setAuthentication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("authResult"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unsuccessfulAuthentication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("h3",{attrs:{id:"认证核心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#认证核心"}},[s._v("#")]),s._v(" 认证核心")]),s._v(" "),t("p",[t("code",[s._v("AuthenticationManager")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("ul",[t("li",[t("p",[s._v("根据用户名先查询出用户对象(没有查到则抛出异常)")]),s._v(" "),t("ul",[t("li",[s._v("此步调用的是"),t("code",[s._v("UserDetialsService")]),s._v("的loadUserByUsername(String username)方法")]),s._v(" "),t("li",[s._v("返回对象"),t("code",[s._v("UserDetails")])])])]),s._v(" "),t("li",[t("p",[s._v("将用户对象的密码和传递过来的密码进行校验，密码不匹配则抛出异常。")]),s._v(" "),t("ul",[t("li",[s._v("密码校验Springsecurity提供了"),t("code",[s._v("PasswordEncoder")])])])])])]),t("p",[s._v("认证过程大致如下")]),s._v(" "),t("ul",[t("li",[s._v("校验用户是否存在"),t("code",[s._v("loadUserByUsername(username)")])]),s._v(" "),t("li",[s._v("校验密码:"),t("code",[s._v("passwordEncoder")])]),s._v(" "),t("li",[s._v("认证成功回填")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Authentication")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Authentication")]),s._v(" authentication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthenticationException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("省略其他代码\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 传递过来的用户名")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" authentication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 调用UserDetailService的方法，通过用户名查询出用户对象UserDetail（查询不出来UserDetailService则会抛出异常）")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserDetails")]),s._v(" userDetails "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUserDetailsService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadUserByUsername")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" presentedPassword "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" authentication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCredentials")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 传递过来的密码")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" authentication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCredentials")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用密码解析器PasswordEncoder传递过来的密码是否和真实的用户密码匹配")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("passwordEncoder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("matches")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" userDetails"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 密码错误则抛出异常")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BadCredentialsException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"错误信息..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 注意哦，这里返回的已认证Authentication，是将整个UserDetails放进去充当Principal")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UsernamePasswordAuthenticationToken")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UsernamePasswordAuthenticationToken")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("userDetails"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            authentication"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCredentials")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" userDetails"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAuthorities")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("省略其他代码\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"},[s._v("注意")]),t("p",[t("code",[s._v("UserDetialsService")]),s._v("、"),t("code",[s._v("UserDetails")]),s._v("、"),t("code",[s._v("PasswordEncoder")]),s._v("，这三个组件Spring Security都有默认实现")]),s._v(" "),t("p",[s._v("这一般是满足不了我们的实际需求的，所以我们自己来实现这些组件！")])]),t("h2",{attrs:{id:"认证方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#认证方式"}},[s._v("#")]),s._v(" 认证方式")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("提示")]),t("p",[s._v("下面使用的都是"),t("code",[s._v("默认的认证方法")]),s._v("（attemptAuthentication）（ authenticate）")])]),t("h3",{attrs:{id:"通过配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过配置文件"}},[s._v("#")]),s._v(" 通过配置文件")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("security")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" zwh\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"基于内存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于内存"}},[s._v("#")]),s._v(" 基于内存")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n1.通过继承WebSecurityConfigurerAdapter类，可以覆盖其中的方法来配置Spring Security的行为\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecurityConfig")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebSecurityConfigurerAdapter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthenticationManagerBuilder")]),s._v(" auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n          1.在内存中获取,配置用户名、密码和角色\n          2.SPS要求密码需要使用密文，可以使用它提供的加密机【有多种】或者自定义加密机\n         */")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BCryptPasswordEncoder")]),s._v(" pe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BCryptPasswordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("inMemoryAuthentication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("withUser")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"张三"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("roles")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PasswordEncoder")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BCryptPasswordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("p",[s._v("这两种方式都不常用【适用于只有少量管理员的场景】，实际开发中都是在数据库查询用户密码")])]),t("h3",{attrs:{id:"基于数据库【重要】"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于数据库【重要】"}},[s._v("#")]),s._v(" 基于数据库【重要】")]),s._v(" "),t("p",[s._v("如果在内存找不到，就会使用"),t("code",[s._v("UserDetailsService")]),s._v("它的"),t("code",[s._v("loadUserByUsername(name)")])]),s._v(" "),t("p",[s._v("即用户认证信息不再从内存查找，通过数据库查询，我们自定义实现类即可，交由Spring管理。")]),s._v(" "),t("ul",[t("li",[s._v("第一步"),t("strong",[s._v("创建配置类")]),s._v(",设置使用哪个userDetailsService实现类")]),s._v(" "),t("li",[s._v("第二步"),t("strong",[s._v("编写实现类")]),s._v("，返回User对象，User对象有用户名密码和操作权限")])]),s._v(" "),t("p",[t("code",[s._v("配置类")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecurityConfig2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebSecurityConfigurerAdapter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserDetailsService")]),s._v(" uds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthenticationManagerBuilder")]),s._v(" auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n          1.userDetailsService获取用户信息，常用于从数据库获取\n          2.passwordEncoder设置密码编码器\n         */")]),s._v("\n        auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("userDetailsService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PasswordEncoder")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BCryptPasswordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[t("code",[s._v("实现类")])]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("ul",[t("li",[s._v("这里最终返回UserDetails对象，可以返回Security提供的User对象，也可以自定义User对象【自带的属性于数据库中不同】")]),s._v(" "),t("li",[s._v("这里查询数据库用户是否存在，用户是否启用、用户权限等，总之于User对象相关的属性，最后返回User对象")])])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//需要注入到配置类，标记为Spring Bean")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpsBean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserDetailsService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserDetails")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadUserByUsername")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UsernameNotFoundException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n         1.在这里我们可以查询数据库获取用户信息、权限等,当前先不使用\n         2.当前下方的User对象由Sps提供的，是返回的结果类型\n         */")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//需要加密，数据库也应该存储加密后的密码，加密算法一个相同")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BCryptPasswordEncoder")]),s._v(" pe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BCryptPasswordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//权限集合【找不到的角色【如这里的role】则可以访问所有资源】，这里取决于User对象是否需要")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GrantedAuthority")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" authorities "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorityUtils")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commaSeparatedStringToAuthorityList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"role"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"li"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" authorities"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h2",{attrs:{id:"授权"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#授权"}},[s._v("#")]),s._v(" 授权")]),s._v(" "),t("p",[s._v("​\t在SpringSecurity中，会使用默认的FilterSecurityInterceptor来进行权限校验。")]),s._v(" "),t("p",[s._v("​\t在FilterSecurityInterceptor中会从SecurityContextHolder获取其中的"),t("strong",[s._v("Authentication")]),s._v("，然后获取其中的权限信息。判断当前用户是否拥有访问当前资源所需的权限。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("ul",[t("li",[s._v("授权在认证之后")]),s._v(" "),t("li",[s._v("我们可以在保存用户之前，在Authentication中封装权限")]),s._v(" "),t("li",[s._v("包含用户的权限、接口的访问权限")])])]),t("h3",{attrs:{id:"代码授权"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代码授权"}},[s._v("#")]),s._v(" 代码授权")]),s._v(" "),t("p",[t("code",[s._v("配置类")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//url后配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasAuthority")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"权限"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasRole")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ROLE_权限名"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasAnyRole")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"权限"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("code",[s._v("实现类")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(554),alt:"image-20231114195900839"}})]),s._v(" "),t("h3",{attrs:{id:"注解授权"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注解授权"}},[s._v("#")]),s._v(" 注解授权")]),s._v(" "),t("p",[s._v("1.先在"),t("strong",[s._v("启动类")]),s._v("或SPS"),t("strong",[s._v("配置类")]),s._v("上添加注解")]),s._v(" "),t("p",[s._v("2.在controller方法上使用相关注解")]),s._v(" "),t("p",[s._v("3.在"),t("code",[s._v("实现类")]),s._v("中控制用户角色")]),s._v(" "),t("p",[t("code",[s._v("实现类")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("去除了手动控制，使用注解控制权限，将test/hello修改为需要权限【通过注解】")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpsBean")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserDetailsService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserMapper")]),s._v(" userMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserDetails")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadUserByUsername")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UsernameNotFoundException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//数据库查询用户认证")]),s._v("\n      \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//实现类配置用户权限【可以从数据库查询】")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GrantedAuthority")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" authorities "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthorityUtils")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commaSeparatedStringToAuthorityList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ROLE_vip1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//替换这里的数据为查询到的数据")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" authorities"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("code",[s._v("配置类")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecurityConfig2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebSecurityConfigurerAdapter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserDetailsService")]),s._v(" uds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthenticationManagerBuilder")]),s._v(" auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("userDetailsService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PasswordEncoder")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BCryptPasswordEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSecurity")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        http\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("authorizeRequests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("antMatchers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/test/login"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("permitAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//哪些路径可以直接访问，无需认证")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("anyRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticated")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//其它请求需要认证【此项放在最后】")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("and")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//关闭csrf防护")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("csrf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("disable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h4",{attrs:{id:"secured"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#secured"}},[s._v("#")]),s._v(" @Secured")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("ul",[t("li",[t("p",[t("code",[s._v("@EnableGlobalMethodSecurity(securedEnabled = true)")])])]),s._v(" "),t("li",[t("p",[s._v("需要ROLE_前缀，只有拥有其中权限的用户可以访问")])])])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Secured")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ROLE_vip1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ROLE_vip2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("helloSpringSecurity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello SpringSecurity"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"preauthorize-常用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#preauthorize-常用"}},[s._v("#")]),s._v(" @PreAuthorize[常用]")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("ul",[t("li",[t("p",[s._v("@EnableGlobalMethodSecurity(prePostEnabled = true)")])]),s._v(" "),t("li",[t("p",[s._v("进入方法前进行权限验证")])]),s._v(" "),t("li",[t("p",[s._v("可以将用户的角色和权限【在SPS上下文】传递给方法.")])])])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//此注解支持代码配置的四种方法")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PreAuthorize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"hasAnyRole('ROLE_admin')\"")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateSpringSecurity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"敏感操作-更新"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"postauthorize"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#postauthorize"}},[s._v("#")]),s._v(" @PostAuthorize")]),s._v(" "),t("p",[s._v("也要开启注解")]),s._v(" "),t("p",[s._v("在方法执行后才校验权限")]),s._v(" "),t("h4",{attrs:{id:"prefilter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prefilter"}},[s._v("#")]),s._v(" @PreFilter")]),s._v(" "),t("p",[s._v("也要开启注解")]),s._v(" "),t("p",[s._v("在进入控制器之前鉴权")]),s._v(" "),t("h2",{attrs:{id:"退出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#退出"}},[s._v("#")]),s._v(" 退出")]),s._v(" "),t("p",[t("code",[s._v("配置类")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("ul",[t("li",[s._v("相关过滤器是LogoutFilter，需要添加到前方，否则用户为空，或者说上下文对象为空")]),s._v(" "),t("li",[s._v("可以配置addLogoutHandler或logoutSuccessHandler，或者都配置来退出")])])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("logout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addLogoutHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("customLogout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addFilterBefore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoginCheckFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redisTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogoutFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("实现类")]),s._v("addLogoutHandler")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomLogout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LogoutHandler")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringRedisTemplate")]),s._v(" redisTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("logout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletRequest")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpServletResponse")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Authentication")]),s._v(" auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPrincipal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        redisTemplate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("delete")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResponseUtil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("out")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"退出成功"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h2",{attrs:{id:"remember-me"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remember-me"}},[s._v("#")]),s._v(" Remember-Me")]),s._v(" "),t("p",[s._v("SpringSecuriry提供了记住我自动登录的功能")]),s._v(" "),t("h3",{attrs:{id:"principle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#principle"}},[s._v("#")]),s._v(" principle")]),s._v(" "),t("p",[s._v("浏览器存储:cookie加密串")]),s._v(" "),t("p",[s._v("数据库存储:加密串、用户信息串")]),s._v(" "),t("p",[t("img",{attrs:{src:a(555),alt:"image-20231114222620263"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://i0.imgs.ovh/2023/11/14/nxKis.png",alt:"image-20231114222839737"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(556),alt:"image-20231114223015034"}})]),s._v(" "),t("h2",{attrs:{id:"csrf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#csrf"}},[s._v("#")]),s._v(" CSRF")]),s._v(" "),t("p",[s._v("跨站请求伪造")]),s._v(" "),t("p",[s._v("​\t同一个浏览器：用户在网站A认证过【信息保存在cookie】，用户访问网站B，但是因为是同一个浏览器，它可以在网站B获取cookie,从而获取用户在网站A的相关信息，通过获取或伪造进而访问到A网站的资源。")]),s._v(" "),t("p",[s._v("​\t从Spring Security 4.0开始，默认情况下会启用CSRF保护，以防止CSRF 攻击应用程序，Spring Security CSRF 会针对PATCH，POST，PUT和DEETE方法进行防护。")]),s._v(" "),t("p",[s._v("之前我们的代码时关闭的，存在风险")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("csrf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("disable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("我们不配置则自动开启，还需要再提交时添加一行就生效了")]),s._v(" "),t("p",[t("img",{attrs:{src:a(557),alt:"image-20231114224851545"}})]),s._v(" "),t("p",[s._v("原理是")]),s._v(" "),t("p",[t("img",{attrs:{src:a(558),alt:"image-20231114224959360"}})]),s._v(" "),t("h2",{attrs:{id:"补充"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#补充"}},[s._v("#")]),s._v(" 补充")]),s._v(" "),t("p",[s._v("username、password、remember-me等需要字段可以再配置类中自定义，一般使用默认的即可")])])}),[],!1,null,null,null);t.default=e.exports}}]);